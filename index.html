<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم چاپ حرفه‌ای کافی نت شهر</title>
    <style>
        /* ==================== استایل‌های اصلی ==================== */
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --accent: #3949ab;
            --success: #2e7d32;
            --warning: #f57c00;
            --danger: #c62828;
            --light: #f5f5f5;
            --dark: #212121;
            --border: #e0e0e0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ==================== هدر ==================== */
        .header {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .header h1 i {
            margin-left: 15px;
            color: #ffeb3b;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .contact-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 50px;
            margin-top: 15px;
            font-weight: bold;
            direction: ltr;
            position: relative;
            z-index: 1;
        }
        
        /* ==================== تب‌ها ==================== */
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #666;
        }
        
        .tab:hover {
            background: #f8f9fa;
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: linear-gradient(to bottom, rgba(26, 35, 126, 0.05), transparent);
        }
        
        .tab i {
            margin-left: 8px;
        }
        
        /* ==================== بخش‌ها ==================== */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ==================== فرم ==================== */
        .form-section {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .section-title {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
            font-size: 1.5rem;
        }
        
        .section-title i {
            margin-left: 12px;
            color: var(--accent);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .form-label .required {
            color: var(--danger);
            margin-right: 5px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 3px rgba(57, 73, 171, 0.1);
        }
        
        .form-control.small {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        
        /* ==================== پلاک خودرو ==================== */
        .plate-container {
            display: flex;
            gap: 5px;
            align-items: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--border);
        }
        
        .plate-part {
            text-align: center;
        }
        
        .plate-input {
            width: 60px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            border: 2px solid #ccc;
            border-radius: 5px;
            background: white;
        }
        
        .plate-separator {
            font-size: 1.5rem;
            color: #666;
            font-weight: bold;
        }
        
        .plate-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* ==================== دکمه‌ها ==================== */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 140px;
        }
        
        .btn i {
            margin-left: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 4px 15px rgba(57, 73, 171, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(45deg, var(--success), #4caf50);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, var(--warning), #ff9800);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 124, 0, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #757575, #9e9e9e);
            color: white;
            box-shadow: 0 4px 15px rgba(117, 117, 117, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        /* ==================== پیش‌نمایش چاپ ==================== */
        .print-preview {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 2px dashed var(--border);
        }
        
        .print-container {
            background: white;
            border: 1px solid #ccc;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            min-height: 1000px;
        }
        
        /* سربرگ */
        .print-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 3px double #333;
        }
        
        .print-title {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        
        .print-subtitle {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .print-contact {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }
        
        /* اطلاعات */
        .print-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin: 40px 0;
        }
        
        .print-info-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-right: 5px solid var(--accent);
        }
        
        .print-info-title {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.3rem;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
        }
        
        .print-info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .print-info-row:last-child {
            border-bottom: none;
        }
        
        .print-info-label {
            font-weight: bold;
            color: #555;
        }
        
        .print-info-value {
            color: #222;
            font-weight: 600;
        }
        
        .print-info-value.amount {
            color: var(--danger);
            font-size: 1.2rem;
        }
        
        /* جزئیات */
        .print-details {
            background: #fff8e1;
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            border: 1px solid #ffd54f;
        }
        
        .print-details-title {
            color: #e65100;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        /* فوتر */
        .print-footer {
            margin-top: 50px;
            padding-top: 25px;
            border-top: 3px double #333;
        }
        
        .print-summary {
            display: flex;
            justify-content: space-between;
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .print-total {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--success);
        }
        
        .print-stamp {
            text-align: center;
            margin: 40px 0;
            position: relative;
        }
        
        .stamp-box {
            display: inline-block;
            border: 2px solid #c62828;
            padding: 30px 60px;
            border-radius: 5px;
            transform: rotate(5deg);
            background: rgba(255,255,255,0.9);
        }
        
        .print-signature {
            text-align: left;
            margin-top: 50px;
        }
        
        .signature-line {
            width: 300px;
            height: 1px;
            background: #333;
            margin: 20px 0 10px;
        }
        
        /* واترمارک */
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 8rem;
            color: rgba(0,0,0,0.05);
            white-space: nowrap;
            font-weight: bold;
            pointer-events: none;
            z-index: 0;
        }
        
        /* سریال */
        .serial-number {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--primary);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        /* ==================== تاریخچه ==================== */
        .history-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .history-table th {
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            text-align: right;
        }
        
        .history-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .history-table tr:hover {
            background: #f5f5f5;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .status-paid {
            background: #e8f5e9;
            color: var(--success);
        }
        
        .status-pending {
            background: #fff3e0;
            color: var(--warning);
        }
        
        /* ==================== تنظیمات ==================== */
        .settings-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .setting-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .setting-card h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .setting-card h4 i {
            margin-left: 10px;
            color: var(--accent);
        }
        
        /* ==================== ریسپانسیو ==================== */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .print-info-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .plate-container {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .print-container {
                padding: 20px;
            }
            
            .watermark {
                font-size: 4rem;
            }
        }
        
        /* ==================== استایل چاپ ==================== */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-container, .print-container * {
                visibility: visible;
            }
            
            .print-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                border: none;
                box-shadow: none;
                background: white;
                min-height: auto;
            }
            
            .btn, .tabs, .header, .form-section,
            .history-section, .settings-section,
            .button-group, .tab-content:not(.active) {
                display: none !important;
            }
            
            @page {
                size: A4;
                margin: 20mm;
            }
            
            .watermark {
                opacity: 0.1;
            }
            
            .print-info-value.amount {
                color: black !important;
            }
        }
        
        /* ==================== ابزارک‌ها ==================== */
        .tooltip {
            position: relative;
            display: inline-block;
            margin-right: 5px;
            color: var(--accent);
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background: var(--dark);
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            right: 50%;
            transform: translateX(50%);
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-info {
            background: #e3f2fd;
            color: #1565c0;
            border-right: 4px solid #2196f3;
        }
        
        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border-right: 4px solid #4caf50;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .color-picker {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- هدر -->
        <div class="header">
            <h1><i class="fas fa-print"></i> سیستم چاپ حرفه‌ای کافی نت شهر</h1>
            <p>چاپ تخصصی خلافی خودرو، طرح ترافیک، جرایم و اسناد رسمی</p>
            <div class="contact-badge">
                <i class="fas fa-phone"></i> 09224044842
            </div>
        </div>
        
        <!-- تب‌ها -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('form')">
                <i class="fas fa-edit"></i> فرم جدید
            </div>
            <div class="tab" onclick="switchTab('preview')">
                <i class="fas fa-eye"></i> پیش‌نمایش
            </div>
            <div class="tab" onclick="switchTab('history')">
                <i class="fas fa-history"></i> تاریخچه
            </div>
            <div class="tab" onclick="switchTab('settings')">
                <i class="fas fa-cog"></i> تنظیمات
            </div>
        </div>
        
        <!-- فرم اصلی -->
        <div id="form" class="tab-content active">
            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-file-alt"></i> فرم ثبت اطلاعات</h2>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> هیچ فیلدی اجباری نیست. فقط اطلاعات مورد نیاز را وارد کنید.
                </div>
                
                <div class="form-grid">
                    <!-- سمت راست -->
                    <div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-car"></i> نوع سند
                            </label>
                            <select class="form-control" id="docType">
                                <option value="">انتخاب کنید (اختیاری)</option>
                                <option value="خلافی خودرو">خلافی خودرو</option>
                                <option value="طرح ترافیک">طرح ترافیک</option>
                                <option value="خلافی موتورسیکلت">خلافی موتورسیکلت</option>
                                <option value="عوارض آزادراه">عوارض آزادراه</option>
                                <option value="جریمه پارک">جریمه پارک</option>
                                <option value="استعلام خودرو">استعلام خودرو</option>
                                <option value="سایر">سایر</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar"></i> تاریخ شمسی
                                <span class="tooltip">?
                                    <span class="tooltiptext">به صورت خودکار تاریخ امروز پر می‌شود</span>
                                </span>
                            </label>
                            <input type="text" class="form-control" id="persianDate" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-tag"></i> شماره پیگیری
                            </label>
                            <input type="text" class="form-control" id="trackingNumber" placeholder="اختیاری">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-map-marker-alt"></i> محل تخلف
                            </label>
                            <input type="text" class="form-control" id="location" placeholder="اختیاری">
                        </div>
                    </div>
                    
                    <!-- سمت چپ -->
                    <div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-barcode"></i> پلاک وسیله نقلیه
                                <span class="tooltip">?
                                    <span class="tooltiptext">برای موتورسیکلت: دو رقم اول و سه رقم آخر وارد شود</span>
                                </span>
                            </label>
                            <div class="plate-container">
                                <div class="plate-part">
                                    <input type="text" class="plate-input" id="plate1" maxlength="2" placeholder="12">
                                    <div class="plate-label">رقم</div>
                                </div>
                                <div class="plate-part">
                                    <select class="form-control small" id="plateLetter">
                                        <option value="الف">الف</option>
                                        <option value="ب">ب</option>
                                        <option value="پ">پ</option>
                                        <option value="ت">ت</option>
                                        <option value="ث">ث</option>
                                        <option value="ج">ج</option>
                                        <option value="د">د</option>
                                        <option value="ز">ز</option>
                                        <option value="س">س</option>
                                        <option value="ش">ش</option>
                                        <option value="ص">ص</option>
                                        <option value="ط">ط</option>
                                        <option value="ق">ق</option>
                                        <option value="ل">ل</option>
                                        <option value="م">م</option>
                                        <option value="ن">ن</option>
                                        <option value="و">و</option>
                                        <option value="ه">ه</option>
                                        <option value="ی">ی</option>
                                    </select>
                                    <div class="plate-label">حرف</div>
                                </div>
                                <div class="plate-separator">–</div>
                                <div class="plate-part">
                                    <input type="text" class="plate-input" id="plate3" maxlength="3" placeholder="123">
                                    <div class="plate-label">رقم</div>
                                </div>
                                <div class="plate-part">
                                    <select class="form-control small" id="plateCity">
                                        <option value="ایران">ایران</option>
                                        <option value="تهران">تهران</option>
                                        <option value="مرکز">مرکز</option>
                                        <option value="غرب">غرب</option>
                                        <option value="شمال">شمال</option>
                                        <option value="جنوب">جنوب</option>
                                        <option value="شرق">شرق</option>
                                    </select>
                                    <div class="plate-label">شهر</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-money-bill-wave"></i> مبلغ (تومان)
                            </label>
                            <input type="number" class="form-control" id="amount" placeholder="اختیاری">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-comment-alt"></i> توضیحات
                            </label>
                            <textarea class="form-control" id="description" rows="3" placeholder="توضیحات اضافی (اختیاری)"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> نام صاحب وسیله
                        </label>
                        <input type="text" class="form-control" id="ownerName" placeholder="اختیاری">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-receipt"></i> هزینه چاپ (تومان)
                        </label>
                        <input type="number" class="form-control" id="printFee" value="5000">
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="generatePreview()">
                        <i class="fas fa-eye"></i> پیش‌نمایش
                    </button>
                    <button class="btn btn-success" onclick="saveAndPrint()">
                        <i class="fas fa-print"></i> ذخیره و چاپ
                    </button>
                    <button class="btn btn-secondary" onclick="clearForm()">
                        <i class="fas fa-redo"></i> پاک کردن فرم
                    </button>
                </div>
            </div>
        </div>
        
        <!-- پیش‌نمایش -->
        <div id="preview" class="tab-content">
            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-print"></i> پیش‌نمایش سند</h2>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> این صفحه برای چاپ بهینه شده است. برای چاپ بهتر، از گزینه "ذخیره به PDF" مرورگر استفاده کنید.
                </div>
                
                <div class="print-preview">
                    <div class="print-container" id="printableDocument">
                        <!-- واترمارک -->
                        <div class="watermark">کافی نت شهر</div>
                        
                        <!-- سریال -->
                        <div class="serial-number" id="serialNumber">S/N: 000001</div>
                        
                        <!-- سربرگ -->
                        <div class="print-header">
                            <div class="print-title">رسید پرداخت</div>
                            <div class="print-subtitle">سند رسمی مالی - چاپ شده توسط کافی نت شهر</div>
                            
                            <div class="print-contact">
                                <div style="display: flex; justify-content: space-between;">
                                    <div>تلفن: <strong>09224044842</strong></div>
                                    <div>تاریخ چاپ: <strong id="printDateToday"></strong></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- اطلاعات اصلی -->
                        <div class="print-info-grid">
                            <div class="print-info-box">
                                <div class="print-info-title">اطلاعات وسیله نقلیه</div>
                                <div class="print-info-row">
                                    <span class="print-info-label">نوع سند:</span>
                                    <span class="print-info-value" id="previewDocType">-</span>
                                </div>
                                <div class="print-info-row">
                                    <span class="print-info-label">پلاک:</span>
                                    <span class="print-info-value" id="previewPlate">-</span>
                                </div>
                                <div class="print-info-row">
                                    <span class="print-info-label">صاحب وسیله:</span>
                                    <span class="print-info-value" id="previewOwner">-</span>
                                </div>
                            </div>
                            
                            <div class="print-info-box">
                                <div class="print-info-title">اطلاعات مالی</div>
                                <div class="print-info-row">
                                    <span class="print-info-label">مبلغ اصلی:</span>
                                    <span class="print-info-value amount" id="previewAmount">0 تومان</span>
                                </div>
                                <div class="print-info-row">
                                    <span class="print-info-label">هزینه چاپ:</span>
                                    <span class="print-info-value" id="previewPrintFee">5,000 تومان</span>
                                </div>
                                <div class="print-info-row">
                                    <span class="print-info-label">کد پیگیری:</span>
                                    <span class="print-info-value" id="previewTracking">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- جزئیات -->
                        <div class="print-details">
                            <div class="print-details-title">جزئیات تکمیلی</div>
                            <div style="margin-top: 15px;">
                                <div class="print-info-row">
                                    <span class="print-info-label">محل تخلف:</span>
                                    <span class="print-info-value" id="previewLocation">-</span>
                                </div>
                                <div class="print-info-row">
                                    <span class="print-info-label">تاریخ صدور:</span>
                                    <span class="print-info-value" id="previewIssueDate">-</span>
                                </div>
                                <div class="print-info-row">
                                    <span class="print-info-label">توضیحات:</span>
                                    <span class="print-info-value" id="previewDescription">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- فوتر -->
                        <div class="print-footer">
                            <div class="print-summary">
                                <div>
                                    <div>جمع کل قابل پرداخت:</div>
                                    <div class="print-total" id="previewTotal">5,000 تومان</div>
                                </div>
                                <div style="text-align: center;">
                                    <div>وضعیت:</div>
                                    <div style="color: #2e7d32; font-weight: bold; margin-top: 5px;">پرداخت شده</div>
                                </div>
                            </div>
                            
                            <div class="print-stamp">
                                <div class="stamp-box">
                                    <div style="font-weight: bold; margin-bottom: 10px;">مهر و امضا</div>
                                    <div>کافی نت شهر</div>
                                </div>
                            </div>
                            
                            <div class="print-signature">
                                <div>مسئول فنی: _______________</div>
                                <div class="signature-line"></div>
                                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                                    این سند به منزله رسید پرداخت می‌باشد و در صورت نیاز باید ارائه گردد.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group" style="margin-top: 30px;">
                        <button class="btn btn-warning" onclick="printDocument()">
                            <i class="fas fa-print"></i> چاپ مستقیم
                        </button>
                        <button class="btn btn-primary" onclick="saveToHistory()">
                            <i class="fas fa-save"></i> ذخیره در تاریخچه
                        </button>
                        <button class="btn btn-secondary" onclick="generatePDF()">
                            <i class="fas fa-file-pdf"></i> ذخیره PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- تاریخچه -->
        <div id="history" class="tab-content">
            <div class="history-section">
                <h2 class="section-title"><i class="fas fa-history"></i> تاریخچه چاپ‌ها</h2>
                
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <input type="text" class="form-control" placeholder="جستجو..." id="searchInput" style="flex: 1;">
                    <button class="btn btn-secondary" onclick="clearHistory()">
                        <i class="fas fa-trash"></i> پاک کردن تاریخچه
                    </button>
                </div>
                
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>ردیف</th>
                            <th>نوع سند</th>
                            <th>پلاک</th>
                            <th>مبلغ</th>
                            <th>تاریخ چاپ</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- با JavaScript پر می‌شود -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- تنظیمات -->
        <div id="settings" class="tab-content">
            <div class="settings-section">
                <h2 class="section-title"><i class="fas fa-cog"></i> تنظیمات سیستم</h2>
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <h4><i class="fas fa-coins"></i> تنظیمات مالی</h4>
                        <div class="form-group">
                            <label class="form-label">هزینه پیش‌فرض چاپ (تومان)</label>
                            <input type="number" class="form-control" id="defaultFee" value="5000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">واحد پول</label>
                            <select class="form-control" id="currency">
                                <option value="تومان">تومان</option>
                                <option value="ریال">ریال</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <h4><i class="fas fa-store"></i> اطلاعات کافی نت</h4>
                        <div class="form-group">
                            <label class="form-label">نام کسب‌وکار</label>
                            <input type="text" class="form-control" id="businessName" value="کافی نت شهر">
                        </div>
                        <div class="form-group">
                            <label class="form-label">شماره تماس</label>
                            <input type="text" class="form-control" id="businessPhone" value="09224044842">
                        </div>
                        <div class="form-group">
                            <label class="form-label">آدرس</label>
                            <input type="text" class="form-control" id="businessAddress" placeholder="آدرس (اختیاری)">
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <h4><i class="fas fa-palette"></i> تنظیمات ظاهری</h4>
                        <div class="form-group">
                            <label class="form-label">رنگ اصلی</label>
                            <input type="color" class="color-picker" id="primaryColor" value="#1a237e">
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showWatermark" checked>
                            <label>نمایش واترمارک</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="autoSerial" checked>
                            <label>سریال خودکار</label>
                        </div>
                    </div>
                </div>
                
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-success" onclick="saveSettings()">
                        <i class="fas fa-save"></i> ذخیره تنظیمات
                    </button>
                    <button class="btn btn-secondary" onclick="resetSettings()">
                        <i class="fas fa-undo"></i> بازنشانی
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- آیکون فونت آسوم -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <script>
        // ==================== متغیرهای عمومی ====================
        let historyData = JSON.parse(localStorage.getItem('kafinetHistory')) || [];
        let settings = JSON.parse(localStorage.getItem('kafinetSettings')) || {
            defaultFee: 5000,
            businessName: "کافی نت شهر",
            businessPhone: "09224044842",
            currency: "تومان",
            primaryColor: "#1a237e",
            showWatermark: true,
            autoSerial: true
        };
        
        let currentSerial = parseInt(localStorage.getItem('lastSerial')) || 1;
        
        // ==================== توابع تاریخ شمسی ====================
        function getPersianDate() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            };
            
            // تاریخ شمسی ساده شده
            const persianDigits = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
            const today = new Date().toLocaleDateString('fa-IR', options);
            
            // تبدیل اعداد انگلیسی به فارسی
            return today.replace(/\d/g, d => persianDigits[d]);
        }
        
        function getShortPersianDate() {
            const now = new Date();
            const year = now.getFullYear() - 621; // تبدیل به شمسی تقریبی
            const month = now.getMonth() + 1;
            const day = now.getDate();
            
            const persianDigits = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
            const convert = num => num.toString().replace(/\d/g, d => persianDigits[d]);
            
            return `${convert(year)}/${convert(month)}/${convert(day)}`;
        }
        
        // ==================== بارگذاری اولیه ====================
        document.addEventListener('DOMContentLoaded', function() {
            // تنظیم تاریخ شمسی
            document.getElementById('persianDate').value = getPersianDate();
            document.getElementById('printDateToday').textContent = getPersianDate();
            
            // بارگذاری تنظیمات
            loadSettings();
            
            // بارگذاری تاریخچه
            loadHistory();
            
            // تنظیم سریال
            updateSerial();
            
            // رویدادهای پلاک
            setupPlateInputs();
        });
        
        // ==================== مدیریت تب‌ها ====================
        function switchTab(tabName) {
            // مخفی کردن همه تب‌ها
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // غیرفعال کردن همه تب‌ها
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // نمایش تب انتخاب شده
            document.getElementById(tabName).classList.add('active');
            
            // فعال کردن تب در نوار
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.textContent.includes(tabName === 'form' ? 'فرم' : 
                    tabName === 'preview' ? 'پیش‌نمایش' : 
                    tabName === 'history' ? 'تاریخچه' : 'تنظیمات')) {
                    tab.classList.add('active');
                }
            });
            
            // اگر تب پیش‌نمایش است، آن را آپدیت کن
            if (tabName === 'preview') {
                generatePreview();
            }
        }
        
        // ==================== مدیریت فرم ====================
        function setupPlateInputs() {
            const plate1 = document.getElementById('plate1');
            const plate3 = document.getElementById('plate3');
            
            plate1.addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2);
                if (this.value.length === 2) {
                    document.getElementById('plateLetter').focus();
                }
            });
            
            plate3.addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '').slice(0, 3);
            });
        }
        
        function getFormData() {
            const plate1 = document.getElementById('plate1').value || '';
            const plateLetter = document.getElementById('plateLetter').value || '';
            const plate3 = document.getElementById('plate3').value || '';
            const plateCity = document.getElementById('plateCity').value || '';
            
            const plate = plate1 || plateLetter || plate3 || plateCity ? 
                `${plate1}${plateLetter}${plate3 ? `-${plate3}` : ''} ${plateCity}` : '';
            
            return {
                docType: document.getElementById('docType').value || 'سند',
                persianDate: document.getElementById('persianDate').value,
                trackingNumber: document.getElementById('trackingNumber').value,
                location: document.getElementById('location').value,
                plate: plate,
                amount: document.getElementById('amount').value || '0',
                ownerName: document.getElementById('ownerName').value,
                description: document.getElementById('description').value,
                printFee: document.getElementById('printFee').value || settings.defaultFee,
                issueDate: getShortPersianDate(),
                serial: currentSerial.toString().padStart(6, '0')
            };
        }
        
        function generatePreview() {
            const data = getFormData();
            
            // آپدیت پیش‌نمایش
            document.getElementById('previewDocType').textContent = data.docType || '-';
            document.getElementById('previewPlate').textContent = data.plate || '-';
            document.getElementById('previewOwner').textContent = data.ownerName || '-';
            document.getElementById('previewAmount').textContent = formatNumber(data.amount) + ' ' + settings.currency;
            document.getElementById('previewPrintFee').textContent = formatNumber(data.printFee) + ' ' + settings.currency;
            document.getElementById('previewTracking').textContent = data.trackingNumber || '-';
            document.getElementById('previewLocation').textContent = data.location || '-';
            document.getElementById('previewIssueDate').textContent = data.issueDate;
            document.getElementById('previewDescription').textContent = data.description || '-';
            
            // محاسبه جمع کل
            const total = parseInt(data.amount || 0) + parseInt(data.printFee || 0);
            document.getElementById('previewTotal').textContent = formatNumber(total) + ' ' + settings.currency;
            
            // آپدیت سریال
            document.getElementById('serialNumber').textContent = `S/N: ${data.serial}`;
            
            // آپدیت تاریخ
            document.getElementById('printDateToday').textContent = data.persianDate;
            
            // نمایش واترمارک
            const watermark = document.querySelector('.watermark');
            watermark.style.display = settings.showWatermark ? 'block' : 'none';
            
            // رفتن به تب پیش‌نمایش
            switchTab('preview');
        }
        
        // ==================== چاپ و ذخیره ====================
        function saveAndPrint() {
            const data = getFormData();
            
            // ذخیره در تاریخچه
            const historyItem = {
                ...data,
                printDate: new Date().toISOString(),
                totalAmount: (parseInt(data.amount || 0) + parseInt(data.printFee || 0)).toString()
            };
            
            historyData.unshift(historyItem);
            localStorage.setItem('kafinetHistory', JSON.stringify(historyData));
            
            // افزایش سریال
            if (settings.autoSerial) {
                currentSerial++;
                localStorage.setItem('lastSerial', currentSerial);
                updateSerial();
            }
            
            // آپدیت تاریخچه
            loadHistory();
            
            // پیش‌نمایش و چاپ
            generatePreview();
            
            // تأخیر برای چاپ
            setTimeout(() => {
                printDocument();
            }, 500);
            
            // نمایش پیام
            alert('✅ سند با موفقیت ذخیره و چاپ شد!');
        }
        
        function printDocument() {
            window.print();
        }
        
        function saveToHistory() {
            const data = getFormData();
            
            const historyItem = {
                ...data,
                printDate: new Date().toISOString(),
                totalAmount: (parseInt(data.amount || 0) + parseInt(data.printFee || 0)).toString()
            };
            
            historyData.unshift(historyItem);
            localStorage.setItem('kafinetHistory', JSON.stringify(historyData));
            loadHistory();
            
            alert('✅ سند در تاریخچه ذخیره شد!');
        }
        
        function generatePDF() {
            alert('🔄 برای ذخیره PDF، پس از کلیک روی چاپ، گزینه "Save as PDF" را انتخاب کنید.');
            setTimeout(() => {
                printDocument();
            }, 100);
        }
        
        // ==================== مدیریت تاریخچه ====================
        function loadHistory() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            // فیلتر جستجو
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const filteredData = historyData.filter(item => 
                !searchTerm || 
                (item.docType && item.docType.toLowerCase().includes(searchTerm)) ||
                (item.plate && item.plate.toLowerCase().includes(searchTerm)) ||
                (item.trackingNumber && item.trackingNumber.toLowerCase().includes(searchTerm))
            );
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px; display: block; opacity: 0.3;"></i>
                            هیچ موردی یافت نشد
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.docType}</td>
                    <td>${item.plate || '-'}</td>
                    <td>${formatNumber(item.totalAmount || '0')} ${settings.currency}</td>
                    <td>${new Date(item.printDate).toLocaleDateString('fa-IR')}</td>
                    <td>
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85rem;" 
                                onclick="loadFromHistory(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85rem; margin-right: 5px;" 
                                onclick="deleteFromHistory(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadFromHistory(index) {
            const item = historyData[index];
            
            // پر کردن فرم
            document.getElementById('docType').value = item.docType;
            document.getElementById('trackingNumber').value = item.trackingNumber || '';
            document.getElementById('location').value = item.location || '';
            document.getElementById('amount').value = item.amount || '';
            document.getElementById('ownerName').value = item.ownerName || '';
            document.getElementById('description').value = item.description || '';
            document.getElementById('printFee').value = item.printFee || settings.defaultFee;
            
            // تجزیه پلاک (ساده شده)
            if (item.plate) {
                const parts = item.plate.split(' ');
                if (parts.length > 0) {
                    const plateParts = parts[0].split('-');
                    if (plateParts.length === 2) {
                        document.getElementById('plate1').value = plateParts[0].slice(0, 2);
                        document.getElementById('plateLetter').value = plateParts[0].slice(2) || 'الف';
                        document.getElementById('plate3').value = plateParts[1];
                    }
                    if (parts[1]) {
                        document.getElementById('plateCity').value = parts[1];
                    }
                }
            }
            
            // رفتن به تب فرم
            switchTab('form');
            
            alert('📝 اطلاعات در فرم بارگذاری شدند. می‌توانید ویرایش و مجدداً چاپ کنید.');
        }
        
        function deleteFromHistory(index) {
            if (confirm('آیا از حذف این آیتم مطمئن هستید؟')) {
                historyData.splice(index, 1);
                localStorage.setItem('kafinetHistory', JSON.stringify(historyData));
                loadHistory();
            }
        }
        
        function clearHistory() {
            if (confirm('آیا از پاک کردن تمام تاریخچه مطمئن هستید؟ این عمل قابل بازگشت نیست.')) {
                historyData = [];
                localStorage.removeItem('kafinetHistory');
                loadHistory();
            }
        }
        
        // ==================== مدیریت تنظیمات ====================
        function loadSettings() {
            document.getElementById('defaultFee').value = settings.defaultFee;
            document.getElementById('businessName').value = settings.businessName;
            document.getElementById('businessPhone').value = settings.businessPhone;
            document.getElementById('businessAddress').value = settings.businessAddress || '';
            document.getElementById('currency').value = settings.currency;
            document.getElementById('primaryColor').value = settings.primaryColor;
            document.getElementById('showWatermark').checked = settings.showWatermark;
            document.getElementById('autoSerial').checked = settings.autoSerial;
            
            // اعمال رنگ
            applyColor(settings.primaryColor);
            
            // آپدیت فرم
            document.getElementById('printFee').value = settings.defaultFee;
        }
        
        function saveSettings() {
            settings.defaultFee = document.getElementById('defaultFee').value;
            settings.businessName = document.getElementById('businessName').value;
            settings.businessPhone = document.getElementById('businessPhone').value;
            settings.businessAddress = document.getElementById('businessAddress').value;
            settings.currency = document.getElementById('currency').value;
            settings.primaryColor = document.getElementById('primaryColor').value;
            settings.showWatermark = document.getElementById('showWatermark').checked;
            settings.autoSerial = document.getElementById('autoSerial').checked;
            
            localStorage.setItem('kafinetSettings', JSON.stringify(settings));
            
            // اعمال تغییرات
            applyColor(settings.primaryColor);
            document.getElementById('printFee').value = settings.defaultFee;
            
            // آپدیت هدر
            document.querySelector('.header h1').innerHTML = `<i class="fas fa-print"></i> سیستم چاپ حرفه‌ای ${settings.businessName}`;
            document.querySelector('.contact-badge').innerHTML = `<i class="fas fa-phone"></i> ${settings.businessPhone}`;
            
            alert('✅ تنظیمات با موفقیت ذخیره شد!');
        }
        
        function resetSettings() {
            if (confirm('آیا می‌خواهید تنظیمات به حالت پیش‌فرض بازگردد؟')) {
                settings = {
                    defaultFee: 5000,
                    businessName: "کافی نت شهر",
                    businessPhone: "09224044842",
                    currency: "تومان",
                    primaryColor: "#1a237e",
                    showWatermark: true,
                    autoSerial: true
                };
                localStorage.setItem('kafinetSettings', JSON.stringify(settings));
                loadSettings();
            }
        }
        
        function applyColor(color) {
            document.documentElement.style.setProperty('--primary', color);
            
            // محاسبه رنگ‌های مرتبط
            const r = parseInt(color.slice(1, 3), 16);
            const g = parseInt(color.slice(3, 5), 16);
            const b = parseInt(color.slice(5, 7), 16);
            
            // رنگ تیره‌تر برای secondary
            const darker = `rgb(${Math.max(0, r-30)}, ${Math.max(0, g-30)}, ${Math.max(0, b-30)})`;
            document.documentElement.style.setProperty('--secondary', darker);
            
            // رنگ روشن‌تر برای accent
            const lighter = `rgb(${Math.min(255, r+30)}, ${Math.min(255, g+30)}, ${Math.min(255, b+30)})`;
            document.documentElement.style.setProperty('--accent', lighter);
        }
        
        // ==================== توابع کمکی ====================
        function formatNumber(num) {
            return parseInt(num || 0).toLocaleString('fa-IR');
        }
        
        function updateSerial() {
            currentSerial = parseInt(localStorage.getItem('lastSerial')) || 1;
        }
        
        function clearForm() {
            if (confirm('آیا می‌خواهید فرم را پاک کنید؟')) {
                document.getElementById('docType').value = '';
                document.getElementById('trackingNumber').value = '';
                document.getElementById('location').value = '';
                document.getElementById('plate1').value = '';
                document.getElementById('plate3').value = '';
                document.getElementById('plateLetter').value = 'الف';
                document.getElementById('plateCity').value = 'ایران';
                document.getElementById('amount').value = '';
                document.getElementById('ownerName').value = '';
                document.getElementById('description').value = '';
                document.getElementById('printFee').value = settings.defaultFee;
            }
        }
        
        // ==================== رویدادهای جستجو ====================
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', loadHistory);
            }
            
            // رویداد تغییر رنگ
            const colorPicker = document.getElementById('primaryColor');
            if (colorPicker) {
                colorPicker.addEventListener('change', function() {
                    applyColor(this.value);
                });
            }
        });
    </script>
</body>
</html>
